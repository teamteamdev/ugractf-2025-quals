# Вращайте барабан!: Write-up

![Скриншот](writeup/field.png)

Перед нами — Google Sheets. В нём два листа. На первом представлено разноцветное поле, в котором легко узнаётся [поле из шоу «Поле Чудес»](https://commons.wikimedia.org/wiki/File:%D0%97%D0%B0%D0%BF%D0%B8%D1%81%D1%8C_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B0%D1%87%D0%B8_%22%D0%9F%D0%BE%D0%BB%D0%B5_%D1%87%D1%83%D0%B4%D0%B5%D1%81%22_26.jpg), на втором — судя по всему, история ходов первой тройки игроков — Ларисы, Анатолия и Петра.

К сожалению, документ доступен только на чтение; и игроки не особо спешат ходить.

Можно заметить, что состояние поля соответствует логу игры — действительно, открыты буквы U и G. И «слово» с ними очень похоже на флаг. Если поисследовать доступную нам часть документа, рано или поздно можно заметить, что в клетке `D6` документа буква `U` не введена руками — вместо этого написана формула.

Изучим её: `=map(transpose(A2:A), lambda(cell, if(iserr(find(cell,$A$1)),"",cell)))`. Функции `map` и `lambda` не представлены в стандартном наборе функций Excel — это [специальные функции](https://support.google.com/docs/answer/12568985) Google Sheets.

Из документации следует, что первый аргумент функции `map` (то есть, `transpose(A2:A)`) воспринимается как массив клеток. К каждой клетке применяется содержимое второго аргумента `lambda`, при этом `cell` заменяется на значение этой клетки. Полученный массив результатов и является результатом формулы — все эти значения вставляются вправо и вниз начиная с нашей клетки.

Функция `transpose` транспонирует массив: `A2:A` это столбец `A`, кроме первой клетки; а результатом будет одна строка.

Теперь посмотрим на внутренность `lambda`: `if(iserr(find(cell,$A$1)),"",cell)`. Если очередная клетка находится в строке `$A$1`, то выводится её содержимое, иначе результат будет пустой клеткой.

Из формулы мы можем заключить, что в каждой клетке D6, E6, … может быть либо пустая строка, либо содержимое клеток A2, A3, …. Соответственно, мы уже знаем, что в клетке A2 находится U, в клетке A3 — G, в клетке A13 — U.

Давайте попробуем достать весь столбик A — скорее всего, если флаг и есть, то он там. Однако сделать это нелегко: автор документа запретил его копировать, печатать и скачивать.

Нам известно по меньшей мере два способа решения:

1. Можно воспользоваться поиском:

   ![](writeup/search.png)

   Поиск по таблице находит и значения в скрытых столбцах. Перебрав все буквы и все совпадения, сможем вручную собрать флаг.

2. В Google Sheets есть формулы, которые позволяют получать данные из внешних источников. Одна из них — [IMPORTRANGE](https://support.google.com/docs/answer/3093340): она позволяет получать данные из другой таблицы.

   Конечно, у неё есть и свои ограничения. Например, доступ к таблице нужно подтверждать. Но это верно только для приватных таблиц — а вот для таблиц с публичным доступом, пусть даже и со скрытым контентом, ничего делать не нужно.

   Создаём таблицу, пишем формулу `=IMPORTRANGE("https://docs.google.com/spreadsheets/d/1Qnu-OppMEIIrz46-XATUv2rVIbXeptx32iDO9y0PsqE/edit", "Field!A:Y")` и видим флаг в первом столбце.

Флаг: **ugra_aaaaaautomobile**
